# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Telegram Bot –¥–ª—è DuckCasino

## –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –Ω–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ **@BotFather**
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot`
3. –í–≤–µ–¥–∏—Ç–µ –∏–º—è –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `DuckCasino`)
4. –í–≤–µ–¥–∏—Ç–µ username –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `duckcasino_bot`)
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π **Bot Token**

## –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Mini App

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É @BotFather –∫–æ–º–∞–Ω–¥—É `/newapp`
2. –í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞
3. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: `DuckCasino`
4. –í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ: `–ö–∞–∑–∏–Ω–æ —Å –∏–≥—Ä–∞–º–∏ –°–∞–ø—ë—Ä –∏ –õ–µ—Å–µ–Ω–∫–∞`
5. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∫–æ–Ω–∫—É 640x360 (–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –≤ –ª—é–±–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ)
6. –ó–∞–≥—Ä—É–∑–∏—Ç–µ GIF –ø—Ä–µ–≤—å—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
7. –í–≤–µ–¥–∏—Ç–µ URL –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: `https://–≤–∞—à-–¥–æ–º–µ–Ω.poehali.dev`

## –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–µ–Ω—é –±–æ—Ç–∞

–û—Ç–ø—Ä–∞–≤—å—Ç–µ @BotFather –∫–æ–º–∞–Ω–¥—É `/setmenu` –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞.
–ó–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤—å—Ç–µ:

```
üéÆ –ò–≥—Ä–∞—Ç—å - launch_app
```

## –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Stars (–ø–ª–∞—Ç–µ–∂–∏)

1. –í @BotFather –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É `/setpayments`
2. –í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞
3. –í–∫–ª—é—á–∏—Ç–µ Telegram Stars –∫–∞–∫ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã

## –®–∞–≥ 5: Webhook –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–ª–∞—Ç–µ–∂–∏, —Å–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç:

```python
from telegram import Update
from telegram.ext import ApplicationBuilder, CommandHandler, ContextTypes

PAYMENT_PROVIDER_TOKEN = ""  # –î–ª—è Stars –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    keyboard = [[InlineKeyboardButton("üéÆ –ò–≥—Ä–∞—Ç—å", web_app=WebAppInfo(url="https://–≤–∞—à-–¥–æ–º–µ–Ω.poehali.dev"))]]
    reply_markup = InlineKeyboardMarkup(keyboard)
    await update.message.reply_text('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ DuckCasino! ü¶Ü', reply_markup=reply_markup)

async def buy_stars(update: Update, context: ContextTypes.DEFAULT_TYPE):
    stars = int(context.args[0]) if context.args else 10
    
    await update.message.reply_invoice(
        title=f"–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞",
        description=f"–ö—É–ø–∏—Ç—å {stars} –∑–≤—ë–∑–¥ = {stars * 10} –º–æ–Ω–µ—Ç –≤ –∫–∞–∑–∏–Ω–æ",
        payload=f"stars_{stars}",
        provider_token=PAYMENT_PROVIDER_TOKEN,
        currency="XTR",  # XTR = Telegram Stars
        prices=[LabeledPrice(label=f"{stars} –∑–≤—ë–∑–¥", amount=stars)]
    )

async def successful_payment(update: Update, context: ContextTypes.DEFAULT_TYPE):
    payment = update.message.successful_payment
    payload = payment.invoice_payload
    stars = int(payload.split('_')[1])
    user_id = update.effective_user.id
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤–∞—à backend
    import requests
    requests.post('https://functions.poehali.dev/b946a71a-3088-4938-8ccc-972fcdaac1c0', json={
        'telegram_id': user_id,
        'stars_amount': stars
    })
    
    await update.message.reply_text(f'–°–ø–∞—Å–∏–±–æ! –í–∞—à –±–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ {stars * 10} –º–æ–Ω–µ—Ç! üéâ')

app = ApplicationBuilder().token("–í–ê–®_BOT_TOKEN").build()
app.add_handler(CommandHandler("start", start))
app.add_handler(CommandHandler("buy", buy_stars))
app.add_handler(MessageHandler(filters.SUCCESSFUL_PAYMENT, successful_payment))

app.run_polling()
```

## –®–∞–≥ 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram
2. –ù–∞–∂–º–∏—Ç–µ "–ò–≥—Ä–∞—Ç—å"
3. Mini App –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å—Å—è –∏ –ø–æ–∫–∞–∑–∞—Ç—å –∫–∞–∑–∏–Ω–æ
4. ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∑—è—Ç –∏–∑ Telegram
5. –ë–∞–ª–∞–Ω—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `users`:
- `telegram_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram (PRIMARY KEY)
- `username` - username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `first_name` - –∏–º—è
- `last_name` - —Ñ–∞–º–∏–ª–∏—è
- `balance` - —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 0)
- `created_at` - –¥–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `updated_at` - –ø–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –¢–∞–±–ª–∏—Ü–∞ `transactions`:
- `id` - ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `telegram_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `amount` - —Å—É–º–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
- `transaction_type` - —Ç–∏–ø: 'payment', 'game', 'bonus'
- `description` - –æ–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `created_at` - –¥–∞—Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

## Backend API Endpoints

### 1. User Management
**URL**: `https://functions.poehali.dev/64460411-3489-48dc-8b81-a5b4f3f2f6aa`

- **GET** `?telegram_id=123456` - –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **POST** - —Å–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  ```json
  {
    "telegram_id": 123456,
    "username": "user",
    "first_name": "John",
    "last_name": "Doe"
  }
  ```
- **PUT** - –∏–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å
  ```json
  {
    "telegram_id": 123456,
    "balance_change": 100,
    "transaction_type": "game",
    "description": "–í—ã–∏–≥—Ä—ã—à"
  }
  ```

### 2. Payment Processing
**URL**: `https://functions.poehali.dev/b946a71a-3088-4938-8ccc-972fcdaac1c0`

- **POST** - –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–ª–∞—Ç–µ–∂
  ```json
  {
    "telegram_id": 123456,
    "stars_amount": 10
  }
  ```

## –û–±–º–µ–Ω: 1 –∑–≤–µ–∑–¥–∞ = 10 –º–æ–Ω–µ—Ç –≤ –∫–∞–∑–∏–Ω–æ

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! üéâ
